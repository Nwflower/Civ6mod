--  FILE: Liuche_Modifier.sql
--  VERSION: 1
--  Author: Nwflower
--  Spicial Thanks: Uni
--  Copyright (c) 2025.
--      All rights reserved.
--  DateCreated: 2025/9/9 21:08:06

--============================================================
-- Lua Support
--============================================================
CREATE TABLE IF NOT EXISTS Nwflower_MOD_Traits(
TraitType TEXT NOT NULL,
PRIMARY KEY (TraitType),
FOREIGN KEY (TraitType) REFERENCES Traits (TraitType) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT OR IGNORE INTO Nwflower_MOD_Traits(TraitType) VALUES
('TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST'),
('TRAIT_LEADER_EN_LINK'),
('TRAIT_LEADER_MUST_KILL');

INSERT OR IGNORE INTO TraitModifiers(TraitType,ModifierId)SELECT
TraitType,				'MODFEAT_TRAIT_PROPERTY_'||TraitType
FROM Nwflower_MOD_Traits;

INSERT OR IGNORE INTO Modifiers(ModifierId,ModifierType)SELECT
'MODFEAT_TRAIT_PROPERTY_'||TraitType,			'MODIFIER_PLAYER_ADJUST_PROPERTY'
FROM Nwflower_MOD_Traits;

INSERT OR IGNORE INTO ModifierArguments(ModifierId,Name,Value)SELECT
'MODFEAT_TRAIT_PROPERTY_'||TraitType,			'Key',	'PROPERTY_'||TraitType
FROM Nwflower_MOD_Traits UNION SELECT
'MODFEAT_TRAIT_PROPERTY_'||TraitType,			'Amount',						1
FROM Nwflower_MOD_Traits;

--============================================================
-- 每座非首都城市为 [ICON_CAPITAL] 首都+1 [ICON_FOOD] 食物。
INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_FOOD', 'MODIFIER_PLAYER_CAPITAL_CITY_ADJUST_CITY_YIELD_CHANGE', 0, 0, 0, NULL, NULL);
INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_FOOD', 'Amount', '1'),
('MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_FOOD', 'YieldType', 'YIELD_FOOD');


INSERT INTO TraitModifiers (TraitType, ModifierId) VALUES
('TRAIT_LEADER_EN_LINK', 'MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_FOOD_ATTACH');
INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_FOOD_ATTACH', 'MODIFIER_PLAYER_CITIES_ATTACH_MODIFIER', 0, 0, 0, NULL, 'NW_CITY_IS_NOT_CAPITAL_CITY');
INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_FOOD_ATTACH', 'ModifierId', 'MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_FOOD');

-- RequirementSets
INSERT INTO RequirementSets (RequirementSetId, RequirementSetType) VALUES
('NW_CITY_IS_NOT_CAPITAL_CITY', 'REQUIREMENTSET_TEST_ALL');
INSERT INTO RequirementSetRequirements (RequirementSetId, RequirementId) VALUES
('NW_CITY_IS_NOT_CAPITAL_CITY', 'REQ_NW_CITY_IS_NOT_CAPITAL_CITY');
-- Requirements
INSERT INTO Requirements (RequirementId, RequirementType,Inverse) VALUES
('REQ_NW_CITY_IS_NOT_CAPITAL_CITY', 'REQUIREMENT_CITY_HAS_BUILDING',1);
INSERT INTO RequirementArguments (RequirementId, Name, Value) VALUES
('REQ_NW_CITY_IS_NOT_CAPITAL_CITY', 'BuildingType', 'BUILDING_PALACE');

-- [ICON_CAPITAL] 首都改良的每种奢侈品资源为非首都城市+1 [ICON_PRODUCTION] 生产力。
-- Custom ModifierType

INSERT INTO Types (Type, Kind) VALUES
('MODIFIER_NW_LC_PLAYER_IMPROVEMENTS_ATTACH_MODIFIER', 'KIND_MODIFIER');
INSERT INTO DynamicModifiers (ModifierType, CollectionType, EffectType) VALUES
('MODIFIER_NW_LC_PLAYER_IMPROVEMENTS_ATTACH_MODIFIER', 'COLLECTION_PLAYER_IMPROVEMENTS', 'EFFECT_ATTACH_MODIFIER');


INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_PRODUCTION', 'MODIFIER_PLAYER_CITIES_ADJUST_CITY_YIELD_CHANGE', 0, 0, 0, NULL, 'NW_CITY_IS_NOT_CAPITAL_CITY');
INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_PRODUCTION', 'Amount', '1'),
('MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_PRODUCTION', 'YieldType', 'YIELD_PRODUCTION');


INSERT INTO TraitModifiers (TraitType, ModifierId) VALUES
('TRAIT_LEADER_EN_LINK', 'MODIFIER_TRAIT_LEADER_EN_LINK_PRODUCTION_ATTACH');
INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_PRODUCTION_ATTACH', 'MODIFIER_NW_LC_PLAYER_IMPROVEMENTS_ATTACH_MODIFIER', 0, 0, 0, NULL, 'REQS_NW_LC_CITY_IS_CAPITAL_CITY');
INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_PRODUCTION_ATTACH', 'ModifierId', 'MODIFIER_TRAIT_LEADER_EN_LINK_CAPITAL_PRODUCTION');

-- RequirementSets
INSERT INTO RequirementSets (RequirementSetId, RequirementSetType) VALUES
('REQS_NW_LC_CITY_IS_CAPITAL_CITY', 'REQUIREMENTSET_TEST_ALL');
INSERT INTO RequirementSetRequirements (RequirementSetId, RequirementId) VALUES
('REQS_NW_LC_CITY_IS_CAPITAL_CITY', 'REQ_NW_LC_CITY_IS_CAPITAL_CITY'),
('REQS_NW_LC_CITY_IS_CAPITAL_CITY', 'REQ_NW_LC_PLOT_HAS_RESOURCECLASS_LUXURY');
-- Requirements
INSERT INTO Requirements (RequirementId, RequirementType) VALUES
('REQ_NW_LC_CITY_IS_CAPITAL_CITY', 'REQUIREMENT_CITY_HAS_BUILDING'),
('REQ_NW_LC_PLOT_HAS_RESOURCECLASS_LUXURY', 'REQUIREMENT_PLOT_RESOURCE_CLASS_TYPE_MATCHES');
INSERT INTO RequirementArguments (RequirementId, Name, Value) VALUES
('REQ_NW_LC_CITY_IS_CAPITAL_CITY', 'BuildingType', 'BUILDING_PALACE'),
('REQ_NW_LC_PLOT_HAS_RESOURCECLASS_LUXURY', 'ResourceClassType', 'RESOURCECLASS_LUXURY');

-- 宫殿+1 [ICON_FAITH] 信仰值。
INSERT INTO TraitModifiers (TraitType, ModifierId) VALUES
('TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST', 'MODIFIER_TRAIT_LEADER_EN_LINK_BUILDING_PALACE_FAITH');

INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_BUILDING_PALACE_FAITH', 'MODIFIER_PLAYER_CITIES_ADJUST_BUILDING_YIELD_CHANGE', 0, 0, 0, NULL, NULL);

INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODIFIER_TRAIT_LEADER_EN_LINK_BUILDING_PALACE_FAITH', 'Amount', '1'),
('MODIFIER_TRAIT_LEADER_EN_LINK_BUILDING_PALACE_FAITH', 'BuildingType', 'BUILDING_PALACE'),
('MODIFIER_TRAIT_LEADER_EN_LINK_BUILDING_PALACE_FAITH', 'YieldType', 'YIELD_FAITH');


-- 单位与政体不相同的文明作战时+2 [ICON_Strength] 战斗力
-- INSERT INTO TraitModifiers (TraitType, ModifierId) VALUES
-- ('TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST', 'MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT');
-- INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
-- ('MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT', 'MODIFIER_PLAYER_UNITS_ADJUST_COMBAT_STRENGTH', 0, 0, 0, NULL, 'REQS_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT');
-- INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
-- ('MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT', 'Amount', '2');
-- INSERT INTO ModifierStrings (ModifierId, Context, Text) VALUES
-- ('MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT', 'Preview', 'LOC_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT');
-- -- RequirementSets
-- INSERT INTO RequirementSets (RequirementSetId, RequirementSetType) VALUES
-- ('REQS_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT', 'REQUIREMENTSET_TEST_ALL');
-- INSERT INTO RequirementSetRequirements (RequirementSetId, RequirementId) VALUES
-- ('REQS_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT', 'REQ_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT');
-- -- Requirements
-- INSERT INTO Requirements (RequirementId, RequirementType, Inverse) VALUES
-- ('REQ_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT', 'REQUIREMENT_PLAYER_HAS_SAME_GOVERNMENT', 1);


INSERT INTO UnitAbilityModifiers (UnitAbilityType, ModifierId) VALUES
('ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH', 'MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH');
INSERT INTO Modifiers (ModifierId, ModifierType, RunOnce, Permanent, NewOnly, OwnerRequirementSetId, SubjectRequirementSetId) VALUES
('MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH', 'MODIFIER_ALL_UNITS_GRANT_ABILITY', 0, 0, 0, NULL, 'REQS_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT1');
INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH', 'AbilityType', 'ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF');

-- RequirementSets
INSERT INTO RequirementSets (RequirementSetId, RequirementSetType) VALUES
('REQS_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT1', 'REQUIREMENTSET_TEST_ALL');
INSERT INTO RequirementSetRequirements (RequirementSetId, RequirementId) VALUES
('REQS_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT1', 'REQ_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT'),
('REQS_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT1', 'REQ_72QB5UPF'),
('REQS_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT1', 'REQ_7GZIE4SC');

-- Requirements
INSERT INTO Requirements (RequirementId, RequirementType, Inverse) VALUES
('REQ_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT', 'REQUIREMENT_PLAYER_HAS_SAME_GOVERNMENT', 1),
('REQ_72QB5UPF', 'REQUIREMENT_PLOT_ADJACENT_TO_OWNER', 0),
('REQ_7GZIE4SC', 'REQUIREMENT_PLAYER_IS_TEAM_MEMBER', 1);
INSERT INTO RequirementArguments (RequirementId, Name, Value) VALUES
('REQ_72QB5UPF', 'MaxDistance', '1'),
('REQ_72QB5UPF', 'MinDistance', '0');


INSERT OR IGNORE INTO Types(Type, Kind)
VALUES ( 'ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF','KIND_ABILITY');
INSERT OR IGNORE INTO TypeTags(Type,Tag)
VALUES ('ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF','CLASS_ALL_UNITS');
INSERT OR IGNORE INTO UnitAbilities(UnitAbilityType,Inactive,Name,Description)
VALUES ( 'ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF', 1 ,'LOC_ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_NAME','LOC_ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_NAME');

INSERT INTO UnitAbilityModifiers (UnitAbilityType, ModifierId) VALUES
('ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF', 'MODIFIER_ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF');
INSERT INTO Modifiers (ModifierId, ModifierType) VALUES
('MODIFIER_ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF', 'MODIFIER_UNIT_ADJUST_COMBAT_STRENGTH');
INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODIFIER_ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF', 'Amount', '-2');
INSERT INTO ModifierStrings (ModifierId, Context, Text) VALUES
('MODIFIER_ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF', 'Preview', 'LOC_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_COMBAT');


INSERT OR IGNORE INTO Types(Type, Kind)
VALUES ( 'ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH','KIND_ABILITY');
INSERT OR IGNORE INTO TypeTags(Type,Tag)
VALUES ('ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH','CLASS_ALL_UNITS');
INSERT OR IGNORE INTO UnitAbilities(UnitAbilityType,Inactive,Name,Description)
VALUES ( 'ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH', 1 ,'LOC_ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH','LOC_ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH');

INSERT INTO TraitModifiers (TraitType, ModifierId) VALUES
('TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST', 'MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF');
INSERT INTO Modifiers (ModifierId, ModifierType) VALUES
('MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF', 'MODIFIER_PLAYER_UNITS_GRANT_ABILITY');
INSERT INTO ModifierArguments (ModifierId, Name, Value) VALUES
('MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF', 'AbilityType', 'ABILITY_MODIFIER_TRAIT_CIVILIZATION_CIV_NW_HAN_RU_BIGGIST_DEBUFF_ATTACH');